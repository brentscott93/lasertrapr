---
title: "lasertrapr"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
editor_options: 
  chunk_output_type: inline
params: 
  rv: NA
  factor_order: NA
  
---

```{r setup, include=FALSE}
library(flexdashboard)
#library(biophysr)
library(lasertrapr)
#library(aomisc)
#devtools::install_github("onofriAndreaPG/aomisc")
library(tidyverse)
library(cowplot)
library(ggpubr)
library(DT)
library(plotly)

```
    
Summary Table
=====================================  
Row 
-------------------------------------
    
### Summary Table
    
```{r, fig.width=14, fig.height=21}
  
d <- params$rv$data$summary
d$conditions <- factor(d$conditions, levels = params$factor_order) 
d %>% 
  dplyr::mutate(across(where(is.numeric), round, digits = 2)) %>% 
     dplyr::select( "Conditions" = conditions,
                    "Step Size (nm)" = displacement_avg,
                    "SE Step" = displacement_se,
                    "Force (pN)" = force_avg,
                    "SE Force" = force_se, 
                    "Time On (ms)" = time_on_avg,
                    "SE Ton" = time_on_se, 
                    'Median Time-on' = time_on_median,
                    "Time Off (ms)" = time_off_avg,
                    "SE Toff" = time_off_se, 
                    "No. Events" = num_events,
                    "Minutes Collected" = minutes ) %>% 
    dplyr::arrange(Conditions) %>% 
    DT::datatable(
              extensions = 'FixedColumns',
              options = list(
                dom = 't',
                scrollX = TRUE,
                fixedColumns = list(leftColumns = 2)
              )
    )
```
 
Stats
=====================================  

Row {.tabset .tabset-fade}
-------------------------------------
    
### Step Size
    
```{r, fig.height = 6, fig.width=12}
params$rv$step
```
    
### Force

```{r, fig.height = 6, fig.width=12}
 params$rv$force
```


### Time On

```{r, fig.height = 6, fig.width=12}
params$rv$ton
```


### Time Off

```{r, fig.height = 6, fig.width=12}
 params$rv$toff
```

ECDF
=============================

```{r, fig.height = 6, fig.width=14}
plot_grid(params$rv$ton_ecdf, params$rv$toff_ecdf, rel_widths = c(0.4, 0.6))
```




Correlations
==============================
```{r fig.width=24, fig.height=8}
params$rv$correlations
```

Stiffness
==============================
```{r  fig.width=14, fig.height=8}
params$rv$stiffness
```

